@using Translator.Models
@{
    ViewBag.Title = "Simple Translator";

    List<RussianWord> russianWords = ViewBag.RussianWords;
    List<EnglishWord> englishWords = ViewBag.EnglishWords;
}

@for (int i = 0; i < russianWords.Count; i++)
{
    <input type="hidden" id="@i russianWord" value="@russianWords[i].Word" />
}
@for (int i = 0; i < englishWords.Count; i++)
{
    <input type="hidden" id="@i englishWord" value="@englishWords[i].Word" />
}

<h2>Simple Translator</h2>

@using (Ajax.BeginForm("GetTranslations", "Simple", new AjaxOptions { UpdateTargetId = "translations" }))
{
    <table>
        <tr>
            <td>
                <div>
                    <input data-toggle="dropdown" class="form-control" name="word" id="word" onkeyup="KeyPress()" />
                    <div class="dropdown" id="input">
                        <a href="#" class="dropdown-toggle-js" id="dropdown" data-toggle="dropdown"></a>
                    </div>
                </div>
            </td>
            <td>
                <button name="submit" id="submit" class="btn btn-default">
                    <span class="glyphicon glyphicon-search"></span>
                </button>
            </td>
        </tr>
    </table>
}

<div class="dropdown">
    <a href="#" class="dropdown-toggle-js" data-toggle="dropdown">
        Ссылка с выпадающим меню
        <b class="caret"></b>
    </a>
    <ul class="dropdown-menu" id="dfg">
        <li><a href="#">Пункт 1</a></li>
        <li><a href="#">Пункт 2</a></li>
        <li class="divider"></li>
        <li><a href="#">Пункт 3</a></li>
    </ul>
</div>

<div id="translations"></div>

@section scripts
{
    <script src="@Url.Content("~/Scripts/jquery.unobtrusive-ajax.js")" type="text/javascript"></script>

    <script>
        var russianWords = []; // Все русские слова
        var englishWords = []; // Все английские слова

        function KeyPress()
        {
            var enteredWord = document.getElementById("word").value;

            if (russianWords.length == 0) {
                russianWords = GetRussianWords();
                englishWords = GetEnglishWords();
            }
            
            var containedWords = [];   // Слова, я вляющиеся подсказками.
            for (var i = 0; i < russianWords.length; i++) {
                if (russianWords[i].indexOf(enteredWord) != -1) {
                    containedWords[containedWords.length] = russianWords[i];
                }

                // Ввыводим не более 5 подсказок на экран.
                if (containedWords.length == 5) {
                    break;
                }
            }
            if (containedWords.length == 0) {
                for (var i = 0; i < englishWords.length; i++) {
                    if (englishWords[i].indexOf(enteredWord) != -1) {
                        containedWords[containedWords.length] = englishWords[i];
                    }

                    // Ввыводим не более 5 подсказок на экран.
                    if (containedWords.length == 5) {
                        break;
                    }
                }
            }

            var ul = document.createElement("ul");
            ul.className = "dropdown-menu";
            ul.id = "containedWords";

            for (var i = 0; i < containedWords.length; i++)
            {
                var li = document.createElement("li");
                //li.className = "list-group-item";
                li.innerHTML = '<a href="#">' + containedWords[i] + '</a>';
                //li.onclick = TipClick(containedWords[i]);
                ul.appendChild(li);
            }
            
            var div = document.getElementById("input");
            if (document.getElementById("containedWords") != null) {
                div.removeChild(document.getElementById("containedWords"));
            }
            div.appendChild(ul);
            document.getElementById("dropdown").dropdown();
        }

        function GetRussianWords()
        {
            var russianWords = [];
            for (var i = 0; document.getElementById(i + " russianWord") != null; ++i) {
                russianWords[i] = document.getElementById(i + " russianWord").value;
            }
            return russianWords;
        }

        function GetEnglishWords()
        {
            var englishWords = [];
            for (var i = 0; document.getElementById(i + " englishWord") != null; ++i) {
                englishWords[i] = document.getElementById(i + " englishWord").value;
            }
            return englishWords;
        }

        function TipClick(word)
        {
            document.getElementById("word").value = word;
            var div = document.getElementById("input");
            if (document.getElementById("containedWords") != null) {
                div.removeChild(document.getElementById("containedWords"));
            }
        }
    </script>
}