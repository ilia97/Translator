@using Translator.Models
@{
    ViewBag.Title = "Simple Translator";

    List<RussianWord> russianWords = ViewBag.RussianWords;
    List<EnglishWord> englishWords = ViewBag.EnglishWords;
}

@for (int i = 0; i < russianWords.Count; i++)
{
    <input type="hidden" id="@i russianWord" value="@russianWords[i].Word" />
}
@for (int i = 0; i < englishWords.Count; i++)
{
    <input type="hidden" id="@i englishWord" value="@englishWords[i].Word" />
}

<h2>Simple Translator</h2>

@using (Ajax.BeginForm("GetTranslations", "Simple", new AjaxOptions { UpdateTargetId = "translations" }))
{
    <table>
        <tr>
            <td>
                <div class="dropdown" id="list">
                    <input data-toggle="dropdown" class="form-control" name="word" id="word" />
                </div>
            </td>
            <td>
                <button name="submit" id="submit" class="btn btn-default">
                    <span class="glyphicon glyphicon-search"></span>
                </button>
            </td>
        </tr>
    </table>
}

<div id="translations"></div>

@section scripts
{
    <script src="@Url.Content("~/Scripts/jquery.unobtrusive-ajax.js")" type="text/javascript"></script>

    <script>
        var russianWords = []; // Все русские слова
        var englishWords = []; // Все английские слова
        var selectedIndex = -1;

        document.getElementById("word").onkeyup = function (event) {
            var enteredWord = document.getElementById("word").value;

            if (russianWords.length == 0) {
                russianWords = GetRussianWords();
                englishWords = GetEnglishWords();
            }

            var containedWords = [];   // Слова, я вляющиеся подсказками.
            for (var i = 0; i < russianWords.length; i++) {
                if (russianWords[i].indexOf(enteredWord) != -1) {
                    containedWords[containedWords.length] = russianWords[i];
                }

                // Ввыводим не более 5 подсказок на экран.
                if (containedWords.length == 5) {
                    break;
                }
            }
            if (containedWords.length == 0) {
                for (var i = 0; i < englishWords.length; i++) {
                    if (englishWords[i].indexOf(enteredWord) != -1) {
                        containedWords[containedWords.length] = englishWords[i];
                    }

                    // Ввыводим не более 5 подсказок на экран.
                    if (containedWords.length == 5) {
                        break;
                    }
                }
            }
            if (event.keyCode == 38) {
                if (selectedIndex < containedWords.length)
                    document.getElementById(selectedIndex + "li").style.backgroundColor = "white";
                if (selectedIndex > 0)
                    selectedIndex--;
                document.getElementById(selectedIndex + "li").style.backgroundColor = "#F0F8FF";
            }
                // Стрелка вниз
            else if (event.keyCode == 40) {
                if (selectedIndex != -1)
                    document.getElementById(selectedIndex + "li").style.backgroundColor = "white";
                if (selectedIndex < containedWords.length - 1)
                    selectedIndex++;
                document.getElementById(selectedIndex + "li").style.backgroundColor = "#F0F8FF";
            }

            else {
                selectedIndex = -1;

                // Удаляем уже существующий список.
                RemoveList();

                var ul = document.createElement("ul");
                ul.className = "dropdown-menu";
                ul.id = "wordList";

                // Добавляем новые подсказки.
                for (var i = 0; i < containedWords.length; i++) {
                    var li = document.createElement("li");
                    li.id = i + "li"
                    li.className = "list-group-item";
                    li.innerHTML = containedWords[i];

                    li.onmouseenter = function (e) {
                        for (var i = 0; i < containedWords.length; i++)
                            document.getElementById(i + "li").style.backgroundColor = "white";
                        e.srcElement.style.backgroundColor = "#F0F8FF";
                        selectedIndex = i;
                    }

                    li.onmouseleave = function (e) {
                        e.fromElement.style.backgroundColor = "white";
                        selectedIndex = -1;
                    }

                    li.onclick = function (e) {
                        document.getElementById("word").value = e.currentTarget.innerHTML;
                        RemoveList();
                    }

                    ul.appendChild(li);
                }

                if (containedWords.length > 0) {
                    document.getElementById("list").appendChild(ul);

                }
            }
        }

        function GetRussianWords()
        {
            var russianWords = [];
            for (var i = 0; document.getElementById(i + " russianWord") != null; ++i) {
                russianWords[i] = document.getElementById(i + " russianWord").value;
            }
            return russianWords;
        }

        function GetEnglishWords()
        {
            var englishWords = [];
            for (var i = 0; document.getElementById(i + " englishWord") != null; ++i) {
                englishWords[i] = document.getElementById(i + " englishWord").value;
            }
            return englishWords;
        }

        function RemoveList() {
            if (document.getElementById("wordList") != null)
                document.getElementById("list").removeChild(document.getElementById("wordList"));
        }
    </script>
}